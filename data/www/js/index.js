(()=>{var e={121:()=>{!function(){const e=document.querySelectorAll(".custom-select"),t=new MutationObserver((e=>{e.forEach((e=>{"value"===e.attributeName&&(document.getElementById(e.target.getAttribute("value")).checked=!0)}))}));function s(e){e.classList.toggle("active"),e.classList.contains("active")?(e.querySelector(":checked").classList.add("__hidden"),e.querySelector(".custom-select-labels").classList.remove("__hidden")):(e.querySelector(":checked").classList.remove("__hidden"),e.querySelector(".custom-select-labels").classList.add("__hidden"))}e.forEach((e=>{t.observe(e,{attributes:!0}),e.setAttribute("value","select-offset"),e.querySelector(".custom-select-labels").classList.add("__hidden");const n=e.querySelectorAll("input[type=radio]"),i=e.querySelectorAll("label");e.addEventListener("click",(()=>{s(e)})),n.forEach((t=>{t.addEventListener("change",(s=>{e.setAttribute("value",t.id)}))})),i.forEach((t=>{t.addEventListener("click",(t=>{s(e)}))}))})),window.addEventListener("click",(t=>{e.forEach((e=>{!e.contains(t.target)&&e.classList.contains("active")&&s(e)}))}))}()}},t={};function s(n){var i=t[n];if(void 0!==i)return i.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,s),o.exports}(()=>{"use strict";async function e(e,t){popup.draw("connecting");try{let s=await fetch(encodeURI(`${URL}/wifi/connect?n=`+e+"&p="+t),{method:"GET"}).then((e=>e.json()));"Not connected."===s.status?popup.draw("alert",options={alertText:"Failed to connect"}):"Connected"===s.status?popup.draw("alert",options={alertText:`Already connected to ${s.ssid}`}):popup.draw("alert",options={alertText:`${s.status} to ${s.ssid}`})}catch(e){console.log(e)}}s(121);let t=!0;window.mainJS=!0;const n="";let i=Math.max(document.documentElement.clientHeight,window.innerHeight||0);const o=new EventSource(`${n}/events`),a=new class{constructor(e,t,s){this.url=e,this.uploading=!1,this.progressCB=t,this.events=s,this.can=!0}getOffset(){let e=document.getElementById("offset").value;return""==e&&(e=document.getElementById("offset").placeholder),Number(e)}canUpdate(){return!this.uploading}unbrick(){try{fetch(`${this.url}/unbrick`),this.events&&(this.events.removeEventListener("flasher",this.progressCB),this.events.addEventListener("flasher",this.progressCB))}catch(e){console.log(e)}}unbrickEvents(e){}upload(e,t){t&&(this.progressCB=t),this.uploading=!0,this.can;const s=new FormData,n=new XMLHttpRequest;n.addEventListener("load",(()=>{200===n.status?this.OTASuccess=!0:500!==n.status?this.OTAError=`[HTTP ERROR] ${n.statusText}`:this.OTAError=n.responseText,this.uploading=!1})),this.progressCB&&n.upload.addEventListener("progress",this.progressCB),this.progressCB&&this.events&&(this.events.removeEventListener("flasher",this.progressCB),this.events.addEventListener("flasher",this.progressCB)),s.append("offset",this.getOffset()),s.append("size",e.size),s.append("firmware",e,e.name),n.open("post",`${this.url}/flash`),n.send(s)}uploadHex(e){e=e.replace(/\s/g,"");const t=new Uint8Array(Math.ceil(e.length/2));for(let s=0;s<t.length;s++)t[s]=parseInt(e.substr(2*s,2),16);const s=new Blob([t.buffer]);progressCallback&&(this.progressCB=progressCallback),this.uploading=!0;const n=new FormData,i=new XMLHttpRequest;i.addEventListener("load",(()=>{200===i.status?this.OTASuccess=!0:500!==i.status?this.OTAError=`[HTTP ERROR] ${i.statusText}`:this.OTAError=i.responseText,this.uploading=!1})),this.progressCB&&i.upload.addEventListener("progress",this.progressCB),this.progressCB&&this.events&&(this.events.removeEventListener("flasher",this.progressCB),this.events.addEventListener("flasher",this.progressCB)),n.append("offset",getOffset()),n.append("size",s.length),n.append("firmware",s,"custom.hex"),i.open("post",`${this.url}/flash`),i.send(n)}end(){this.events.removeEventListener("flasher",this.progressCB)}}(n,(function(e){if("flasher"==e.type){if(isNaN(e.data[0])||""==e.data)"Will flash"==e.data?document.documentElement.style.setProperty("--flash-progress","55%"):"Flashed succesfully"==e.data?(document.documentElement.style.setProperty("--flash-progress","100%"),t=!0):"Erase failed"==e.data.slice(0,12)||"Unbrick failed"==e.data.slice(0,14)?c.draw("alert",{alertText:e.data}):"Link init failed"==e.data&&c.draw("alert",{alertText:"Failed to initialize the Link.\nCheck the connection."});else{let t=e.data.split("/")[0]/e.data.split("/")[1]*50;document.documentElement.style.setProperty("--flash-progress",`${t}%`)}l.update(`[${e.data}]\n`)}}),o),c=new class{constructor(e,t,s){this.container=e,this.popupDiv=e.querySelector(".popup"),this.content=e.querySelector(".content"),this.confButs=e.querySelector(".confirm-buttons"),this.updater=t,this.url=s}draw(t,s){switch(this.clearPopup(),t){case"wifi-connect":this.makeLabel(s.wifiName,"wifi-ap-password"),this.makeInput("Password","wifi-ap-password","password"),this.makeButton("Connect",(()=>{s.callback()})),this.makeButton("Cancel",this.closePopup);break;case"wifi-manual":this.makeLabel("Add WiFi","wifi-ap-name"),this.makeInput("Name","wifi-ap-name","text"),this.makeInput("Password","wifi-ap-password","password"),this.makeButton("Connect",(()=>{e(document.getElementById("wifi-ap-name").value,document.getElementById("wifi-ap-password").value)})),this.makeButton("Cancel",this.closePopup);break;case"wifi-info":this.content.innerHTML=`<p>${s.wifiName}</p>\n          <p>Signal strength: ${s.signal}</p>\n          <p>Link's IP: ${s.ip}</p>`,this.makeButton("Ok",this.closePopup);break;case"reboot":this.makeAlert("Reset connected board?"),this.makeButton("Yes",(()=>{try{fetch(`${this.url}/reset`)}catch(e){console.log(e)}this.closePopup()})),this.makeButton("Cancel",this.closePopup);break;case"unbrick":this.makeAlert("This will erase all flash."),this.makeButton("Ok",(()=>{this.updater.unbrick(),this.closePopup()})),this.makeButton("Cancel",this.closePopup);break;case"ignore-file-type":this.makeAlert("Selected file is not binary. Are you sure you want to proceed?"),this.makeButton("Yes",(()=>{this.closePopup()})),this.makeButton("Oops",(()=>{s.cb(),this.closePopup()}));break;case"connecting":this.makeAlertProgress("Connecting");break;case"alert":this.makeAlert(s.alertText),this.makeButton("Ok",this.closePopup);break;case"about":const t='<div class="about-popup"><p>WCH WebLink</p>\n        <p>ESP32 programmer for CH32V003.<br/>\n        Based on <a href="https://github.com/cnlohr/ch32v003fun/tree/master/minichlink" target="_blank">minichlink</a> by cnlohr.</p>\n        <p>Â©2024</p><div class="group-horizontal">\n        <a href="https://github.com/Subjective-Reality-Labs/WCH_WebLink" target="_blank">\n        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 33 33">\n        <path fill-rule="evenodd" d="M16.289,0C7.294,0,0,7.293,0,16.29c0,7.197,4.667,13.303,11.141,15.457\n          c0.814,0.148,1.112-0.354,1.112-0.785c0-0.387-0.014-1.412-0.022-2.771c-4.531,0.984-5.487-2.184-5.487-2.184\n          c-0.741-1.881-1.809-2.383-1.809-2.383c-1.479-1.01,0.112-0.99,0.112-0.99c1.635,0.115,2.495,1.68,2.495,1.68\n          c1.453,2.488,3.813,1.77,4.741,1.354c0.148-1.053,0.569-1.771,1.034-2.178c-3.617-0.412-7.42-1.809-7.42-8.051\n          c0-1.778,0.635-3.232,1.677-4.371c-0.167-0.412-0.727-2.068,0.16-4.311c0,0,1.368-0.438,4.479,1.67\n          c1.299-0.361,2.693-0.542,4.078-0.548c1.384,0.006,2.776,0.187,4.078,0.548c3.11-2.108,4.476-1.67,4.476-1.67\n          c0.889,2.243,0.329,3.899,0.162,4.311c1.043,1.139,1.674,2.593,1.674,4.371c0,6.258-3.809,7.635-7.438,8.038\n          c0.585,0.504,1.105,1.498,1.105,3.018c0,2.178-0.02,3.934-0.02,4.469c0,0.436,0.293,0.941,1.12,0.783\n          c6.468-2.158,11.13-8.26,11.13-15.455C32.579,7.293,25.286,0,16.289,0z"/>\n        </svg></a>\n        <a href="http://subjectiverealitylabs.com/" target="_blank">\n        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 192 192">\n          <path d="M93.1,135.14c-1.92-1.37-7-1.24-9-1.2H79l-3.3,15.59,6.58,0c3.6-.19,7.69-.42,9.93-2.35a8.34,8.34,0,0,0,2.87-6.69C95.15,138,94.46,136.12,93.1,135.14Z"/>\n          <path d="M192,0H0V192H192V60L166.15,45,192,30ZM54.26,144.45H48.49a1,1,0,0,1-1-1.25,7.62,7.62,0,0,0,.26-2.66c-.19-4.46-4.06-7.33-9.88-7.33-3.11,0-8.34,1-8.34,7.4,0,3.53,2.54,4.68,9.88,7.47l.94.35c5.82,2.24,12,5.33,12,13.71,0,9.62-6.59,15.6-17.21,15.6-4.45,0-9.87-.54-13.72-4.39l-.55,2.85a1,1,0,0,1-1,.81H14a1,1,0,0,1-.78-.37,1,1,0,0,1-.2-.84L16.34,160a1,1,0,0,1,1-.8h5.77a1,1,0,0,1,.77.37,1,1,0,0,1,.21.82,16.65,16.65,0,0,0-.28,3c0,3.26,1,7.61,10,7.61,3.64,0,9.73-1.11,9.73-8.56,0-3.85-5.09-5.8-10.48-7.88l-.26-.1c-5.86-2.22-12.1-5.3-12.1-13.7,0-10.55,9.15-14.29,17-14.29,5.13,0,9.61,1.65,12.41,4.5l.71-3a1,1,0,0,1,1-.77h5.91a1,1,0,0,1,1,1.22l-3.36,15.18A1,1,0,0,1,54.26,144.45Zm44.8,18.93a32.28,32.28,0,0,1-.84,7h3.41a1,1,0,0,1,.78.37,1,1,0,0,1,.2.84l-1,4.68a1,1,0,0,1-1,.78H90a1,1,0,0,1-.77-.37,1,1,0,0,1-.2-.84,57.44,57.44,0,0,0,1.65-12.05c0-5.78-1.78-7-5.53-7.4-3-.16-5.24-.21-7.23-.14H74.19l-3.07,14.13h5.33a1,1,0,0,1,.77.37,1,1,0,0,1,.21.83l-1,4.67a1,1,0,0,1-1,.8H56.37a1,1,0,0,1-.77-.37,1,1,0,0,1-.21-.83l1-4.67a1,1,0,0,1,1-.8H62.5l7.89-36.4H65.13a1,1,0,0,1-.77-.37,1,1,0,0,1-.2-.84l1-4.67a1,1,0,0,1,1-.79h19c5.13,0,10.44,0,13.78,2.58,3.34,2,5,5.26,5,9.66,0,7.06-3.84,11.88-10.7,13.68C97.44,154.92,99.06,158,99.06,163.38Zm47.21,12.83a1,1,0,0,1-1,.8H106.52a1,1,0,0,1-.77-.37,1,1,0,0,1-.2-.83l.94-4.67a1,1,0,0,1,1-.8H113l7.61-36.4H115.5a1,1,0,0,1-.77-.36,1,1,0,0,1-.21-.84l1-4.67a1,1,0,0,1,1-.8H136.6a1,1,0,0,1,1,1.2l-1,4.67a1,1,0,0,1-1,.8h-6.34l-7.61,36.4h17.59l2.24-10.81a1,1,0,0,1,1-.8h6.13a1,1,0,0,1,1,1.21Z"/>\n        </svg></a></div></div>';this.content.innerHTML+=t,this.makeButton("Ok",this.closePopup);break;case"update":this.makeInputFile("Select firmware file",(()=>{this.content.parentElement.querySelector(".but").disabled=!1})),this.makeCheckbox("Allow downgrade","downgrade"),this.makeButton("Upload",(()=>{const e=this.content.querySelector(".file-input").files[0];this.clearPopup(),this.makeAlert("Uploading firmware"),this.updater.upload(e,(e=>{const t=this.content.querySelector("h2");if("progress"===e.type)t.innerHTML=`Uploading update\n${parseInt(e.loaded/e.total*100)}%`;else if("updater"===e.type)t.innerHTML=`${e.data}`;else if("tarprogress"===e.type){let s=t.innerHTML.split("\n")[0];t.innerHTML=`${s}\n${e.data}`}}))}),!0),this.makeButton("Cancel",this.closePopup)}this.container.classList.add("active")}clearPopup(){this.confButs.innerHTML="",this.content.innerHTML=""}closePopup(){this.container.addEventListener("transitionend",(()=>{this.clearPopup()}),{once:!0}),this.container.classList.remove("active")}makeInputFile(e,t=null){const s=`file_input_${Math.random().toString(36).slice(2,7)}`,n=`<div class="file-container">\n    <input type="file" id="${s}" class="file-input">\n    <label for="${s}" class="file-label">${e}</label>\n    </div>`;this.content.innerHTML+=n;const i=document.getElementById(s),o=i.nextElementSibling,a=o.parentElement;i.addEventListener("change",(e=>{o.innerHTML=e.target.value.split("\\").pop(),null!=t&&t()})),["dragenter","dragover","dragleave","drop"].forEach((e=>{a.addEventListener(e,(e=>{e.preventDefault(),e.stopPropagation()}))})),["dragenter","dragover"].forEach((e=>{a.addEventListener(e,(()=>{a.classList.add("highlight")}))})),["dragleave","drop"].forEach((e=>{a.addEventListener(e,(()=>{a.classList.remove("highlight")}))})),a.addEventListener("drop",(e=>{i.files=e.dataTransfer.files,o.innerHTML=i.value.split("\\").pop(),null!=t&&t()}))}makeButton(e,t,s=!1){const n=document.createElement("button");return s&&(n.disabled=!0),n.classList.add("but"),n.innerText=e,n.addEventListener("click",t.bind(this)),this.confButs.appendChild(n),n}makeAlert(e){const t=`<h2>${e}</h2>`;this.content.innerHTML+=t}makeAlertProgress(e){const t=`<h2 class="progress">${e}</h2>`;this.content.innerHTML+=t}makeLabel(e,t){const s=`<label name=${t} for=${t}>${e}</label>`;this.content.innerHTML+=s}makeInput(e,t,s){const n=`<input type="${s}" id=${t} placeholder=${e}>`;this.content.innerHTML+=n}makeCheckbox(e,t){const s=`<div class="check-lbl">\n    <input type="checkbox" id="${t}">\n    <label for="${t}">${e}</label>\n    </div>`;this.content.innerHTML+=s}}(document.querySelector(".popup-container"),a,n),r=new class{constructor(e,t,s=null){this.div=e,this.endpoint=t,this.inputs=this.div.querySelectorAll(".setting"),this.inputsLocal=this.div.querySelectorAll(".setting-local"),s.nested&&(this.nested=s.nested),this.default=s.default}async populateUI(e){(e||null===this.settings)&&await this.download(),null===this.settings&&console.error(`Can't access settings from ${this.endpoint}`),this.inputs.forEach((e=>{e.id in this.settings&&this._setValue(e,this.settings[e.id])}));for(let e in this.nested){const t=this.nested[e].querySelectorAll(".setting"),s=this.settings[e];t.forEach((e=>{const t=e.id.split(":")[1];t in s&&this._setValue(e,s[t])}))}this.inputsLocal.forEach((e=>{const t=localStorage.getItem(e.id);t&&this._setValue(e,JSON.parse(t))})),document.getElementById("sw_version").innerHTML=`v.${(this.settings.sw_version/100).toFixed(2)}`}_setValue(e,t){void 0===e.value?e.classList.contains("custom-select")?e.setAttribute("value",e.id+":"+t):e.setAttribute("value",t):"checkbox"===e.type?e.checked=t:e.value=-1==t?"":t}_getValue(e){let t;return t=void 0===e.value?e.classList.contains("custom-select")?e.getAttribute("value").split(":")[1]:e.getAttribute("value"):"checkbox"===e.type?e.checked:e.value,t}save(e,t){let s,n=!0;if(this.inputsLocal.forEach((e=>{localStorage.setItem(e.id,JSON.stringify(this._getValue(e)))})),e==this.div)this.inputs.forEach((e=>{if("text"===e.getAttribute("type")&&!e.checkValidity())return console.log("FALSE"),n=!1,s=e,!1;this.settings[e.id]=this._getValue(e)}));else for(let t in this.nested)e.querySelectorAll(".setting").forEach((e=>{if("text"===e.getAttribute("type")&&!e.reportValidity())return console.log("FALSE"),n=!1,s=e,!1;const i=e.id.split(":")[1];this.settings[t][i]=this._getValue(e)}));if(!0===t&&!0===n)try{this.upload()}catch(e){console.log(e)}return!1===n&&s}async download(){try{let e=await fetch(this.endpoint,{method:"GET"}).then((e=>e.json()));this.settings=e}catch(e){console.log(e),this.settings=this.default}}async upload(){console.log(JSON.stringify(this.settings)),await fetch(this.endpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.settings)})}}(document.querySelector(".card.set"),`${n}/rest/settings`,{nested:{wifi:document.querySelector(".card.wifi")},default:{wifi:{hotspot_name:"WebLink",hotspot_password:"ch32v003isfun"},uart:!1,swio_pin:10,t1coeff:7,pin3v3:-1,poll_delay:1e3,sw_version:100}}),l=new class{constructor(e,t,s,n,i,o){this.url=e,this.canSend=!0,this.willSend=!1,this.connecting=!1,this.updateCB=t,this.connectCB=s,this.disconnectCB=n,this.sendCB=i,this.events=o,this.sendButton=document.querySelector("#terminal-send"),this.input=document.querySelector("#terminal-input"),this.window=document.querySelector(".terminal-text"),this.parseEvents=this.parseEvents.bind(this),this.sendButton.addEventListener("click",(()=>{this.send()})),this.input.addEventListener("keydown",(e=>{"Enter"===e.key&&this.send()}))}connect(){try{this.connecting=!0,this.connection=new WebSocket(`ws://${this.url}`),this.events&&(this.events.removeEventListener("terminal",this.parseEvents),this.events.addEventListener("terminal",this.parseEvents)),this.connection.addEventListener("open",(()=>{this.connection.send("Connected"),this.connecting=!1,this.connectCB()})),this.connection.addEventListener("error",(e=>{console.log("WebSocket Error ",e),this.connection.close(),this.disconnectCB()})),this.connection.addEventListener("message",(e=>{e.data instanceof Blob?e.data.text().then((e=>{"#"==e[0]&&(null!=this.updateCB&&this.updateCB(e.slice(1)),this.update(e.slice(1)))})):console.log("Server: ",e.data)})),this.connection.addEventListener("close",(()=>{console.log("WebSocket connection closed"),delete this.connection,this.disconnectCB()})),this.sendButton.classList.remove("deactive")}catch(e){console.log(e),this.connecting=!1}}disconnect(){this.events.removeEventListener("terminal",this.parseEvents),this.connection.close()}send(e=""){this.canSend?(this.canSend=!1,this.willSend=!1,1===this.connection.readyState&&(""==e?(this.connection.send(`#${this.input.value}\n`),this.update(`>_  ${this.input.value}\n`),this.input.value=""):(this.connection.send(e),this.update(`>_ ${e}\n`)),this.sendButton.classList.add("deactive"),setTimeout((()=>{this.sendButton.classList.remove("deactive")}),1e3),this.sendCB())):this.willSend=!0}parseEvents(e){console.log(e.data),"+"==e.data&&(this.canSend=!0,this.sendButton.classList.remove("deactive")),"-"==e.data&&(this.canSend=!1,this.sendButton.classList.add("deactive"))}update(e){let t=this.window.value+e,s=t.split("\n");s.length>500&&(s.splice(0,s.length-500),t=s.join("\n")),this.window.value=t,document.querySelector("#terminal-scroll").classList.contains("deactive")||(this.window.scrollTop=this.window.scrollHeight)}}(`${n?n.replace(/(^\w+:|^)\/\//,""):location.hostname}/terminal`,(e=>{}),(()=>{v.classList.add("hide"),f.classList.remove("hidden")}),(()=>{v.classList.remove("hide"),f.classList.add("hidden")}),(()=>{}),o),d=document.documentElement,u=document.querySelector(".wifi-connect"),h=document.querySelector(".micro"),p=document.querySelector(".micro.clone"),m=document.querySelector(".terminal"),v=(document.querySelector(".terminal > textarea"),document.querySelector(".terminal > .but.connect")),f=document.querySelector(".terminal-controls"),g=document.querySelector("#offset"),L=document.querySelectorAll("#select-offset > input[type=radio]"),w=document.querySelector("#firmware_file"),y=document.querySelector(".file-label"),E=document.querySelector(".file-container"),b=document.querySelector(".flash"),k=document.querySelector(".about"),S=document.querySelector("#reset"),C=document.querySelector("#unbrick"),q=document.querySelector(".settings-button"),x=document.querySelectorAll(".set-buttons > .but"),T=document.querySelectorAll(".cards > .card"),A=document.querySelectorAll(".more"),B=document.querySelector(".settings"),$=document.querySelector("#custom-hex-check"),H=document.querySelector("#custom-hex");function P(){!0===JSON.parse(localStorage.getItem("load_full"))&&function(){let e=document.querySelector(".micro > .content");h.classList.add("block-transitions"),m.classList.add("block-transitions"),h.classList.remove("closed","out"),h.classList.add("open"),p.classList.add("hidden"),e.classList.add("visible"),e.classList.remove("hidden"),m.classList.remove("closed"),m.classList.add("open")}(),document.querySelectorAll(".preload-transitions").forEach((e=>{e.classList.remove("preload-transitions")})),d.style.setProperty("--true-height",Math.max(document.documentElement.clientHeight,window.innerHeight||0)+"px"),function(e){const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.innerHTML='<path d="M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.21,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.21,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.67 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z" /></svg>',t.setAttribute("viewBox","0 0 24 24"),t.setAttribute("style","height: 100%;"),e.appendChild(t)}(q),F(),"AP"==document.querySelector('meta[name="wifi"]').content&&(B.classList.add("block-transitions"),B.classList.remove("hide"),M(B.querySelector(".wifi.card"),B.querySelector(".wifi.but")),setTimeout((()=>{B.classList.remove("block-transitions")}),100))}function M(e,t){const s=Array.from(T).indexOf(e);T.forEach(((t,n)=>{t===e?t.classList.add("active"):(s>n?(t.classList.remove("hidden-down"),t.classList.add("hidden-up")):(t.classList.remove("hidden-up"),t.classList.add("hidden-down")),t.classList.remove("active"))})),x.forEach((e=>{e===t?e.classList.add("active"):e.classList.remove("active")}))}function _(e,t){e.forEach(((e,s)=>{e.title==t&&(L[s].checked=!0)}))}async function F(){const e=document.querySelector(".wifi-current.but");try{let t=await fetch(`${n}/wifi/report`,{method:"GET"}).then((e=>e.json()));"Not connected."===t.status?e.innerHTML=`AP mode: ${t.ap_ssid}`:e.innerHTML=`${t.ssid}`,B.querySelectorAll(".confirm-buttons").forEach((e=>{e.classList.remove("visible")})),document.querySelectorAll(".content .more-div").forEach((e=>{e.classList.remove("active"),e.removeAttribute("style")})),document.querySelectorAll(".content .more").forEach((e=>{e.classList.remove("active")})),r.populateUI(!0),O()}catch(e){console.log(e)}}function N(e){document.getElementById("settings").contains(e.target)||document.querySelector(".popup-container").contains(e.target)||q.contains(e.target)||I(e)}function I(e){e&&e.stopPropagation(),B.classList.contains("hide")?(F(),B.classList.remove("hide"),M(B.querySelector(".set.card"),B.querySelector(".set.but")),window.addEventListener("click",N),window.addEventListener("touchend",N)):(window.removeEventListener("click",N),window.removeEventListener("touchend",N),B.classList.add("hide"),B.querySelector(".confirm-buttons").classList.remove("visible"))}function O(){document.querySelector("#pin3v3").value>0&&""!=document.querySelector("#pin3v3").value?C.innerHTML="unbrick":C.innerHTML="erase"}function z(e){e.value=null,e.dispatchEvent(new InputEvent("change"))}async function W(...e){let t=5;for(;t>0;){try{return await fetch(...e)}catch(e){console.log(e)}t-=1}throw new Error("Too many retries")}window.addEventListener("pageshow",(e=>{e.persisted&&window.location.reload()})),"loading"!==document.readyState?P():document.addEventListener("DOMContentLoaded",(function(){P()})),window.addEventListener("resize",(()=>{i=Math.max(document.documentElement.clientHeight,window.innerHeight||0),d.style.setProperty("--true-height",Math.max(document.documentElement.clientHeight,window.innerHeight||0)+"px")})),p.addEventListener("click",(()=>{p.classList.add("out"),p.classList.add("animate-out"),p.addEventListener("animationend",(()=>{p.classList.add("hidden"),h.classList.remove("out"),h.addEventListener("transitionend",(()=>{h.classList.remove("closed"),h.style.height="30rem",h.addEventListener("transitionend",(()=>{let e=document.querySelector(".micro > .content");e.classList.add("visible"),e.classList.remove("hidden"),h.classList.add("open"),h.style.height=null}),{once:!0}),m.classList.remove("closed"),m.classList.add("open")}),{once:!0})}),{once:!0})})),g.addEventListener("change",(()=>{g.value[1].toLowerCase(),"0"!=g.value[0]||"x"!=g.value[1]?g.value="0x"+g.value.toUpperCase():g.value="0x"+g.value.substr(2).toUpperCase(),function(e){switch(e){case"0x08000000":_(L,"flash");break;case"0x1FFFF000":_(L,"bootloader");break;case"0x1FFFF800":_(L,"option");break;case"0x20000000":_(L,"ram");break;default:_(L,"custom")}}(g.value)})),document.querySelector("#select-offset").addEventListener("change",(()=>{!function(e){switch(document.querySelector("#select-offset").getAttribute("value")){case"flash":g.value="0x08000000";break;case"bootloader":g.value="0x1FFFF000";break;case"option":g.value="0x1FFFF800";break;case"ram":g.value="0x20000000"}}()})),w.addEventListener("change",(()=>{""!=w.value&&("application/octet-stream"!=w.files[0].type&&w.files[0].size<=16384?(console.log("Wrong file type"),console.log(w.files[0].type),c.draw("ignore-file-type",{cb:()=>{z(w)}})):w.files[0].size>16384&&(console.log("File size too big for WCH32v003"),z(w),b.classList.add("hidden"),y.innerText="Select binary",c.draw("alert",{alertText:"File size is too big for ch32v003. Max size is 16384 bytes"}))),""==w.value?(y.innerText="Select binary",b.classList.add("hidden")):(y.innerText=w.files[0].name,b.classList.remove("hidden"))})),k.addEventListener("click",(()=>{c.draw("about")})),v.addEventListener("click",(()=>{l.connect(),f.classList.remove("hidden")})),document.querySelector("#terminal-scroll").addEventListener("click",(()=>{document.querySelector("#terminal-scroll").classList.toggle("deactive")})),document.querySelector("#terminal-close").addEventListener("click",(()=>{l.disconnect()})),b.addEventListener("click",(()=>{t&&($.checked&&""!=H.value&&H.checkValidity()&&a.uploadHex(H.value),a.upload(w.files[0]),t=!1,l.update("[Uploading binary]\n"),document.documentElement.style.setProperty("--flash-progress","0%"),setTimeout((()=>{document.documentElement.style.setProperty("--flash-progress","100%"),t=!0}),3e3))})),S.addEventListener("click",(()=>{c.draw("reboot")})),C.addEventListener("click",(()=>{c.draw("unbrick")})),x.forEach((e=>{e.addEventListener("click",(()=>{const t=e.classList[0];M(document.querySelector("."+t+".card"),e)}))})),A.forEach((e=>{e.addEventListener("click",(()=>{const t=e.nextElementSibling;e.classList.toggle("active"),function(e,t=null){e.classList.contains("active")||!1===t?(e.setAttribute("style","--h:0"),e.classList.remove("active")):(e.style.setProperty("--h",e.scrollHeight),e.classList.add("active"))}(t)}))})),T.forEach((e=>{e.childNodes.forEach((t=>{t.addEventListener("change",(()=>{e.querySelector(".confirm-buttons").classList.add("visible")}))}))})),document.querySelectorAll(".confirm-buttons .but.save").forEach((e=>e.addEventListener("click",(()=>{(function(e){let t=r.save(e,!0);return!!t&&(t.classList.add("error"),t.addEventListener("input",(function(){this.classList.remove("error")}),{once:!0}),O(),!0)})(e.parentNode.parentNode)||e.parentNode.classList.remove("visible")})))),q.addEventListener("click",I,!0),$.addEventListener("change",(()=>{$.checked?(H.classList.remove("hidden"),b.classList.remove("hidden"),b.classList.add("only"),E.classList.add("hex")):(H.classList.add("hidden"),""==w.value&&b.classList.add("hidden"),b.classList.remove("only"),E.classList.remove("hex"))})),document.querySelector("#pin3v3").addEventListener("change",(()=>{O()})),new ResizeObserver((e=>{for(let t of e)t.target.style.setProperty("--list-width",t.target.clientWidth+"px")})).observe(u.querySelector(".networks")),document.querySelector(".wifi-connect > .title").addEventListener("click",(function(){!async function(e){const t=e.querySelector(".title > h3"),s=e.querySelector(".networks");e.classList.add("scan"),t.innerHTML="Scanning";const i=await W(`${n}/wifi/list`,{method:"GET"}).then((e=>e.text()));var o,a;console.log(i),e.classList.remove("scan"),t.innerHTML="Available networks",e.classList.add("ready"),"0"!=i&&(o=i,(a=s).innerHTML="",o.split("\n").forEach((e=>{let t=e.split(",");const s=document.createElement("li"),i=document.createElement("div"),o=document.createElement("div");i.classList.add("wifi-signal"),o.classList.add("wifi-security"),function(e,t){const s=document.createElementNS("http://www.w3.org/2000/svg","svg"),n=document.createElementNS("http://www.w3.org/2000/svg","path");if(s.setAttribute("viewBox","-100 -200 200 200"),n.setAttribute("fill","#000000"),e<100){const t=document.createElementNS("http://www.w3.org/2000/svg","path"),i=document.createElementNS("http://www.w3.org/2000/svg","path");n.setAttribute("d",`m 0 -18 l ${-.8*e} ${-.8*e} q ${.8*e} ${-.6*e} ${1.6*e} 0 z`),t.setAttribute("d","m 0 0 l -100 -100 q 100 -80 200 0 z"),t.setAttribute("fill","#000000"),i.setAttribute("d","m 0 -18 l -80 -80 q 80 -60 160 0 z"),i.setAttribute("fill","#FFFFFF"),s.appendChild(t),s.appendChild(i)}else n.setAttribute("d",`m 0 0 l ${-1*e} ${-1*e} q ${e} ${-.8*e} ${2*e} 0 z`);s.appendChild(n),t.appendChild(s)}(t[0],i),"1"===t[1]&&function(e){const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.innerHTML='<rect x="5" width="40" height="25" fill="black" stroke="white"/>\n  <rect y="21" width="50" height="35" fill="black"/>\n  <rect x="15" y="9" width="20" height="12" fill="white"/>\n  <rect x="20" y="34" width="10" height="10" fill="white"/>',t.setAttribute("viewBox","0 0 56 56"),t.setAttribute("style","position: absolute; right: 0rem; bottom: 0rem; height: 0.4em; width: 0.4em;"),e.appendChild(t)}(i);const r=document.createElement("p");r.innerText=t[2],s.addEventListener("click",(function(){c.draw("wifi-connect",{wifiName:this.innerText,callback:()=>{!async function(e,t){c.draw("connecting");try{let s=await W(encodeURI(`${n}/wifi/connect?n=`+e+"&p="+t),{method:"GET"}).then((e=>{if("application/json"==e.headers.get("content-type"))return e.json()}));console.log(s),"Not connected."===s.status?c.draw("alert",{alertText:"Failed to connect"}):"Connected"===s.status?c.draw("alert",{alertText:`Already connected to ${s.ssid}`}):c.draw("alert",{alertText:`${s.status} to ${s.ssid}`})}catch(e){console.log(e)}}(this.innerText.trim(),document.getElementById("wifi-ap-password").value)}})})),a.appendChild(s),a.style.setProperty("--list-width",a.clientWidth+"px"),s.appendChild(i),s.appendChild(r),s.appendChild(o),function(e){e.style.setProperty("--own-width",e.scrollWidth+"px"),e.style.setProperty("animation-play-state","running")}(r)})))}(this.parentNode)})),document.querySelector(".wifi-connect > .manual").addEventListener("click",(function(){c.draw("wifi-manual")})),document.querySelector(".but.wifi-current").addEventListener("click",(async function(){try{let e,t=await fetch(`${n}/wifi/report`,{method:"GET"}).then((e=>e.json()));console.log(t),e="Not connected."===t.status?`AP mode: ${t.ap_ssid}`:`${t.ssid}`,c.draw("wifi-info",{wifiName:e,ip:t.ip,signal:`${t.rssi}%`})}catch(e){console.log(e)}})),history.pushState(null,null,window.location.pathname),["dragenter","dragover","dragleave","drop"].forEach((e=>{E.addEventListener(e,(e=>{e.preventDefault(),e.stopPropagation()}))})),["dragenter","dragover"].forEach((e=>{E.addEventListener(e,(()=>{E.classList.add("highlight")}))})),["dragleave","drop"].forEach((e=>{E.addEventListener(e,(()=>{E.classList.remove("highlight")}))})),E.addEventListener("drop",(e=>{w.files=e.dataTransfer.files,w.dispatchEvent(new InputEvent("change"))})),setTimeout((()=>{1!=window.mainJS&&window.location.reload()}),1e3)})()})();